#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require 'rsyncbackup'

class App
  include Methadone::Main
  include Methadone::CLILogging

  if logger.info?
    logger.level=Logger::WARN
  end
  

  main do |source, target|
    options[:source] = source
    options[:target] = target
    syncer = Rsyncbackup.new(options)
    syncer.run
    syncer.finalize
  end

  description "Yet another rsync backup script, this time in ruby"

  on("-e FILE","--exclusions","Exclusions file")
  on("-d","--[no-]dry-run","Mark this as a dry run (or not)")
  on("-v","--verbose","Be chatty")
  

  arg :source, "Source to backup from"
  arg :target, "Target backup directory"

  version Rsyncbackup::VERSION

  use_log_level_option

  go!
end
